---
title: "Project 1"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(investr)
# command+shift+c
formula = ~ldose
data = beetle
X = model.matrix(formula, data =beetle)
beta = matrix(0,ncol(beetle)-1) #initial values
m = length(n)
q = ncol(beetle)-1
y = data$y
n = data$n
i = 1
epsilon = 1

while (epsilon > 0.1) {
  eta = X%*%beta #sum(X%*%beta)        #linear predictor
  pi = exp(eta)/(1+exp(eta))

  S = t(X)%*%(y-n*pi)
  D = diag(c(n*pi*(1-pi)),nrow = m)
  F = (t(X)%*%D%*%X) + diag(10^(-10), nrow = nrow(F)) #add a small number to the diagonal to be able to invert the matrix
  F_inv  = solve(F)
  print(i)
  i = i+1

  beta_new = beta + F_inv%*%S
  print(beta_new)
  epsilon = norm(beta_new - beta)/norm(beta)
  beta = beta_new
}
eta = X%*%beta
likelihood = y*eta - n*log(1+exp(eta))

#RSS = sum((y-eta)^2)
#sigma_2 = RSS/(m-q)
#Cov = solve(t(X)%*%X)*sigma_2
#stderr = sqrt(diag(Cov))

#Find estimates of standard error of maximum likelihood 
#VET IKKE HVORDAN DETTE GJØRES???

coef = cbind(likelihood, stderr)
coef

#Find deviance
deviance = -2*(likelihood - l2)
#HVA ER L2 HER???


#DET ER EGT AKKURAT DET SAMME UNDER HER; JEG HAR BARE TESTA UTEN Å SETTE DET INN I FUNKSJONEN OVER

myglm <- function(formula, dataset) {
  X = model.matrix(formula, data = dataset)
  beta = matrix(0,ncol(dataset)-1) #initial values
  
  y = data$y
  n = data$n
  m = length(n)
  q = ncol(beetle)-1
  i = 1
  epsilon = 1
  
  while (epsilon > 0.1) {
    eta = X%*%beta #sum(X%*%beta)        #linear predictor
    pi = exp(eta)/(1+exp(eta))
    
    S = t(X)%*%(y-n*pi)
    D = diag(c(n*pi*(1-pi)),nrow = length(y)) 
    F = (t(X)%*%D%*%X) + diag(10^(-10), nrow = nrow(F)) #add a small number to the diagonal to be able to invert the matrix
    F_inv  = solve(F)
    print(i)
    i = i+1
    
    beta_new = beta + F_inv%*%S
    print(beta_new)
    epsilon = norm(beta_new - beta)/norm(beta)
    beta = beta_new
    
  }
  eta = X%*%beta
  likelihood = y*eta - n*log(1+exp(eta))
  RSS = sum((y-eta)^2)
  sigma_2 = RSS/(m-q)
  Cov = solve(t(X)%*%X)*sigma_2
  stderr = sqrt(diag(Cov))
  
  coef = cbind(likelihood, stderr)
  result <- list(coef,deviance)
  return(result)
}


summary(glm(cbind(y,n-y) ~ ldose, binomial, data=beetle))




```

