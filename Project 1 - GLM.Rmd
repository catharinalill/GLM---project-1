---
title: "TMA4315: Compulsory exercise 1 (title)" 
subtitle: "Group XXX: Aurora Hofman, Camilla Karlsen, Catharina Lilleengen" 
date: "`r format(Sys.time(), '%d.%m.%Y')`"
output: html_document
---
# Expressions for the log likelihood, the score function and the Fisher information 

## The log likelihood function

## The score function

## Fisher information

# Implementation of the Fisher scoring algorithm

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(investr)
myglm <- function(formula, dataset) {
  X = model.matrix(formula, data = dataset)
  beta = matrix(0,ncol(dataset)-1)                      # Initial values
  
  y = data$y
  n = data$n
  m = length(n)
  q = ncol(beetle)-1
  i = 1
  epsilon = 1
  
  while (epsilon > 10^(-4)) {
    eta = X%*%beta                                      # Linear predictor
    pi = exp(eta)/(1+exp(eta))
    
    S = t(X)%*%(y-n*pi)                                 # Score function
    D = diag(c(n*pi*(1-pi)),nrow = length(y)) 
    F = (t(X)%*%D%*%X) + diag(10^(-10), nrow = nrow(F)) # Add a small number to the diagonal of the
    F_inv  <- solve(F)                                  # Fisher information matrix to be able to                                                            invert the matrix
    print(i)
    i = i+1
    
    beta_new <- beta + F_inv%*%S                        # Calculate new estimates for the 
    print(beta_new)                                     # regression  coefficients 
    epsilon <- norm(beta_new - beta)/norm(beta)
    beta <- beta_new
    
  }
  eta = X%*%beta
  y_bar <- y/n
  pi_hat <- exp(eta)/(1+exp(eta))

  stderr <- sqrt(diag(F_inv))                           # Standard error for regression                                                                      coefficients
  
  #Find deviance
  deviance <- 2*sum(y*log(y_bar/pi_hat) + (n-y)*log((1-y_bar)/(1-pi_hat)))
  deviance  
  #sum(y[i]* log(y_bar[i]/pi_hat[i])-(n[i]-y[i]) 
  
  coef <- cbind(beta, stderr)
  result <- list(coef,deviance)
  result
  return(result)
}


summary(glm(cbind(y,n-y) ~ ldose, binomial, data=beetle))


```
Comment on the observed deviance!!
